# App Android / iOS

Responsable: Richard

## Mise en place

R√©cup√©ration d‚Äôune branche solito

Se placer dans le dossier `studio-test-native/apps/expo` et installer le projet avec `yarn`

NOTE: Pr√©parer les fichiers n√©cessaires aux notifications via Firebase au besoin


## Notifications

### Firebase

NOTE: üìñ [https://console.firebase.google.com](https://console.firebase.google.com/)

A l‚Äôaide du compte dev@wappizy.com, cr√©er un projet, et y inscrire les apps Android et iOS.

Pour iOS, se rendre dans les param√®tres du projet / cloud messaging pour y renseigner la **Cl√© d'authentification APNs** √† l‚Äôaide des √©l√©ments suivants

- fichier .p8
- l‚Äôid de cl√©
- l‚Äôid de l‚Äô√©quipe

Firebase fournit les fichiers relatifs aux plateformes suivants: 

- GoogleService-Info.plist (iOS)
- google-services.json (Android)

## App.tsx

renseigner l‚Äôurl du site dans BASE_URL_TO_POINT

## Assets

Renseigner les images du dossier assets : splash, icon, et adaptive-icon. Ils sont utilis√©s dans le fichier app.json suivant.

## app.json

Renseigner tous les √©l√©ments :

[src, JavaScript]
.app.json
----
{
  "expo": {
    "name": "SmartDiet",
    "slug": "smartdiet",
    "scheme": "smartdiet",
    "version": "0.0.1",
    "jsEngine": "hermes",
    "orientation": "portrait",
    "icon": "./assets/icon.png",
    "userInterfaceStyle": "light",
    "splash": {
      "image": "./assets/splash.png",
      "resizeMode": "contain",
      "backgroundColor": "#ffffff"
    },
    "updates": {
      "fallbackToCacheTimeout": 0
    },
    "assetBundlePatterns": [
      "**/*"
    ],
    "ios": {
      "supportsTablet": true,
      "bundleIdentifier": "com.smartdiet.app",
      "googleServicesFile": "./GoogleService-Info.plist",
      "infoPlist": {
        "NSCameraUsageDescription": "$(PRODUCT_NAME) souhaite acc√©der √† l&apos;appareil photo. Autorisez l&apos;acc√®s √† votre cam√©ra pour capturer des photos. Vous pouvez utiliser celles-ci pour votre profil et votre journal alimentaire.",
        "NSPhotoLibraryUsageDescription": "$(PRODUCT_NAME) souhaite acc√©der √† vos photos. Autorisez l&apos;acc√®s √† votre galerie pour charger des photos. Vous pouvez utiliser celles-ci dans votre profil et votre journal alimentaire.",
        "UIBackgroundModes": [
          "fetch",
          "remote-notification"
        ]
      }
    },
    "android": {
			/* Permissions de base sur Android : */
      "permissions": ["android.permission.POST_NOTIFICATIONS"],
      "adaptiveIcon": {
        "foregroundImage": "./assets/adaptive-icon.png",
        "backgroundColor": "#FFFFFF"
      },
      "package": "com.smartdiet.app",
      "googleServicesFile": "./google-services.json"
    },
    "plugins": [
      "@react-native-firebase/app",
      [
        "expo-build-properties",
        {
          "ios": {
            "useFrameworks": "static" // N√©cessaire pour notif's
          }
        }
      ]
    ],
    "extra": {
      "eas": {
        "projectId": "bfdb399e-44d0-48ef-9a21-0cb4f63b90a9"
      }
    }
  }
}
----

## Emulateur

Afin de v√©rifier que tout est bien param√©tr√©, et que le build se fait, lancer la commande suivante

```bash
npx expo run:android
npx expo run:ios
```

## Expo

Pour cr√©er l‚Äôarchive Android .aab ou iOS, il est n√©cessaire de sortir des fichiers .gitignore les fichiers googleService (expo exclut ces fichiers lors de l‚Äôenvoi de la codebase)

```bash
eas build --platform ios
# ou
eas build --platform android 
```